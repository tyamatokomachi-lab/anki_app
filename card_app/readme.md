### 1. プログラムの目的

このプログラムは、指定されたGoogleスプレッドシートからデータを読み込み、その内容を基に、印刷に適したレイアウトのフラッシュカードをPDFファイルとして生成するウェブアプリケーションです。また、生成前に仕上がりを確認できるよう、PDFのプレビュー画像をブラウザに表示する機能も備えています。

### 2. 主要機能

* **Googleスプレッドシートからのデータ取得:**
    * 指定されたスプレッドシートのデータを行単位で読み込みます。
    * 各行は1枚のフラッシュカードに対応します。
    * `text_front` (表面テキスト)、`text_back` (裏面テキスト)、`image_directory` (画像のディレクトリ) 、`image_filename` (画像のファイル名) の3つの列を必須とします。

* **Google Cloud Storageからの画像ダウンロード:**
    * スプレッドシートの環境変数に指定されたGoogle Cloud Storage (GCS)バケットの中にあるimage_directoryのimage_filenameの画像ファイルを、アプリケーションが一時的に動作するローカルディレクトリにダウンロードします。

* **PDF生成:**
    * スプレッドシートのデータとダウンロードした画像を基に、PDFファイルを作成します。
    * ウェブインターフェースから指定された列数・行数（例: 2列×3行）でページをレイアウトします。
    * 表面と裏面それぞれについてPDFを生成し、ユーザーが印刷しやすいようにします。（表面は正順、裏面は逆順です）

* **プレビュー画像生成:**
    * PDFを生成する前に、その仕上がりをJPEG形式のプレビュー画像としてブラウザに表示します。
    * 幅いっぱいに1ページが表示され、１ページごとにクリックすると裏面が表示される仕様です。Popplerを使用しないという制約

* **GCS上のファイルの追加削除リスト表示機能:**
    * 単語カードで使うGCSのファイルをリスト表示させたり、削除したり、ドロップダウンで追加したりする機能を用意します。

* **ウェブインターフェース (UI):**
    * ユーザーがスプレッドシート名、列数、行数を入力できるシンプルなフォームを提供します。
    * 「プレビュー」「PDF生成」のボタンがあり、それぞれの機能の実行をトリガーします。

### 3. ファイル構成

| ファイル名 | 役割 |
| :--- | :--- |
| `app.py` | プログラムのメインファイル。Flaskサーバーを起動し、HTTPリクエストを処理します。 |
| `spreadsheet_manager.py` | Google Sheets APIと連携し、スプレッドシートのデータを取得します。 |
| `gcs_manager.py` | Google Cloud Storageと連携し、画像をダウンロードします。 |
| `pdf_generator.py` | ReportLabライブラリを使用して、PDFファイルを生成します。 |
| `preview_image_generator.py` | PDFファイルを画像に変換し、プレビュー画像を生成します。 |
| `config.py` | プロジェクトIDやバケット名などの設定情報を管理します。 |
| `requirements.txt` | プログラムの実行に必要なPythonライブラリの一覧です。 |
| `templates/index.html` | ウェブインターフェースのフロントエンド部分です。 |


### 5. プログラムの実行手順

1.  `.env`ファイルに認証情報を設定します。
2.  `requirements.txt`のリストに従って、必要なPythonライブラリをすべてインストールします。
4.  ターミナルで `flask run` コマンドを実行し、サーバーを起動します。
5.  ブラウザで表示されたURLにアクセスします。
